<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Credit Card Payment Demo</title>
<style>
  :root{ --maroon:#8A100B; --gold:#EAAA00; --muted:#6b7280; --ring:#e5e7eb; }
  body{ font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin:0; padding:20px; background:#fff; color:#111;}
  .wrap{ max-width:900px; margin:0 auto; }
  header{ margin-bottom:20px; }
  h1{ color:var(--maroon); margin:0 0 6px; }
  .sub{ color:var(--muted); margin:0; }
  .card{ padding:20px; border:1px solid var(--ring); border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,.05); }
  label{ font-weight:600; }
  .options label{ display:block; margin:8px 0; font-weight:600; }
  input[type="number"]{ padding:8px; border-radius:6px; border:1px solid var(--ring); }
  input[type="range"]{ width:100%; accent-color:var(--maroon); }
  .results{ display:flex; gap:20px; margin-top:10px; }
  .stat{ flex:1; background:#fafafa; border:1px solid var(--ring); padding:12px; border-radius:10px; }
  .stat .k{ color:var(--muted); }
  .stat .v{ font-size:1.6rem; font-weight:800; }
  .bar{ margin-top:16px; }
  .lab{ display:flex; justify-content:space-between; color:var(--muted); font-size:.95rem; margin-bottom:6px; }
  .track{ height:12px; background:#eee; border-radius:8px; overflow:hidden; }
  .fill{ height:100%; width:0%; background:linear-gradient(90deg,var(--maroon),var(--gold)); }
  footer{ margin-top:20px; font-size:.9rem; color:var(--muted); text-align:center; }
  .help-icon{ display:inline-block; margin-left:6px; background:#ccc; color:#000; font-weight:800; border-radius:50%; width:20px; height:20px; line-height:20px; text-align:center; cursor:pointer; border:none; font-size:.9rem; }
  .slider-box{ display:none; margin-top:8px; padding:10px; background:#f9f9f9; border:1px solid #ddd; border-radius:8px; }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Credit Card Payment Demo</h1>
    <p class="sub">Select a payment option and see payoff details. <span class="mono">(for research demo only)</span></p>
  </header>

  <main class="card" role="region" aria-label="Calculator">
    <!-- Payment Options -->
    <section aria-labelledby="options-title">
      <h2 id="options-title" style="margin:0 0 8px; font-size:1.1rem;">Payment Amount</h2>
      <div class="options">
        <label><input type="radio" name="payOption" value="2836.90" checked> Statement Balance: $2836.90</label>
        <label><input type="radio" name="payOption" value="2875.11"> Current Balance: $2875.11</label>
        <label><input type="radio" name="payOption" value="28.00"> Minimum Payment Due: $28.00</label>
        <label>
          <input type="radio" name="payOption" value="other"> Other Amount:
          <button type="button" class="help-icon" id="sliderHelp" aria-controls="sliderBox" aria-expanded="false" aria-label="Set a custom payment amount">?</button>
        </label>
        <!-- Hidden slider box (enabled inputs; just hidden by default) -->
        <div class="slider-box" id="sliderBox">
          <p style="margin:0 0 8px;">Select a custom payment amount:</p>
          <input id="paymentInput" type="number" min="0" max="100000" step="1" value="500" />
          <input id="paymentRange" type="range" min="0" max="3000" step="10" value="500" />
        </div>
      </div>
    </section>

    <!-- Results -->
    <section aria-labelledby="results-title">
      <h2 id="results-title" style="margin:16px 0 8px; font-size:1.1rem;">Results</h2>
      <div class="results" role="status" aria-live="polite">
        <div class="stat"><div class="k">Years to Pay Off</div><div class="v" id="yearsOut">—</div></div>
        <div class="stat"><div class="k">Total Balance After Interest</div><div class="v" id="totalOut">—</div></div>
      </div>
      <div class="bar">
        <div class="lab"><span>Progress toward payoff</span><span id="progLabel">0%</span></div>
        <div class="track"><div class="fill" id="fill"></div></div>
      </div>
    </section>
  </main>

  <footer>Demo Website for Research Use Only</footer>
</div>

<script>
  // ---- Config ----
  const INITIAL_BALANCE = 2836.90;
  const YEARS_DIVISOR   = 200;   // (remaining)/200
  const INTEREST_MULT   = 1.4;   // (remaining)*1.4

  // ---- Elements ----
  const paymentRange = document.getElementById('paymentRange');
  const paymentInput = document.getElementById('paymentInput');
  const yearsOut     = document.getElementById('yearsOut');
  const totalOut     = document.getElementById('totalOut');
  const fillEl       = document.getElementById('fill');
  const progLabel    = document.getElementById('progLabel');
  const sliderBox    = document.getElementById('sliderBox');
  const sliderHelp   = document.getElementById('sliderHelp');

  // ---- Math ----
  function compute(payment){
    const pay = Math.max(0, Math.min(Number(payment)||0, INITIAL_BALANCE));
    const remaining = INITIAL_BALANCE - pay;
    return {
      pay,
      years: remaining / YEARS_DIVISOR,
      total: remaining * INTEREST_MULT,
      progress: (INITIAL_BALANCE - remaining) / INITIAL_BALANCE
    };
  }

  // ---- Qualtrics postMessage ----
  function sendToQualtrics(payment) {
    if (window.parent && window.parent.postMessage) {
      window.parent.postMessage({ type: "paymentChoice", value: payment }, "*");
    }
  }

  // ---- Render ----
  function render(payment){
    const {pay, years, total, progress} = compute(payment);

    // keep inputs in sync
    if (pay > Number(paymentRange.max)) paymentRange.max = Math.ceil(pay);
    paymentRange.value = pay;
    paymentInput.value = pay;

    yearsOut.textContent = `${years.toFixed(2)} yrs`;
    totalOut.textContent = `$${total.toFixed(2)}`;

    const pct = Math.round(progress * 100);
    fillEl.style.width = `${pct}%`;
    progLabel.textContent = `${pct}%`;

    sendToQualtrics(pay);
    console.log("Rendered with payment:", pay);
  }

  // ---- Events: slider + number ----
  paymentRange.addEventListener('input', e => render(+e.target.value));
  paymentInput.addEventListener('input', e => render(+e.target.value));

  // ---- Events: radio options ----
  document.querySelectorAll('input[name="payOption"]').forEach(radio => {
    radio.addEventListener('change', () => {
      if (radio.value === 'other') {
        // don't force open; let ? control visibility
        render(+paymentInput.value);
      } else {
        render(+radio.value);
      }
    });
  });

  // ---- Toggle the slider box via ? ----
  sliderHelp.addEventListener('click', () => {
    const isHidden = window.getComputedStyle(sliderBox).display === 'none';
    sliderBox.style.display = isHidden ? 'block' : 'none';
    sliderHelp.setAttribute('aria-expanded', String(isHidden));
  });

  // ---- Init ----
  const checked = document.querySelector('input[name="payOption"]:checked');
  render(checked && checked.value !== 'other' ? +checked.value : +paymentInput.value);
</script>
</body>
</html>
